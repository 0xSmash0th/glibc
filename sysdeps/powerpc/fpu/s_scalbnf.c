/* s_scalbnf.c -- float version of s_scalbn.c.
   Copyright (C) 2011 Free Software Foundation, Inc.
   This file is part of the GNU C Library.
   Contributed by Adhemerval Zanella <azanella@br.ibm.com>, 2011

   The GNU C Library is free software; you can redistribute it and/or
   modify it under the terms of the GNU Library General Public License as
   published by the Free Software Foundation; either version 2 of the
   License, or (at your option) any later version.

   The GNU C Library is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
   Library General Public License for more details.

   You should have received a copy of the GNU Library General Public
   License along with the GNU C Library; see the file COPYING.LIB.  If not,
   write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
   Boston, MA 02111-1307, USA.  */

#include "math.h"
#include "math_private.h"

#include "s_float_bitwise.h"

static const float huge   = 1.0e+30;
static const float tiny   = 1.0e-30;
static const float two25  = 3.35544320e+07;
static const float twom25 = 2.98023224e-08;

/* (float)(i << 23), 0<=i<255 -  [ 2**0, 2**-126, ... , 2**127 ] */
static const float pow2[] = {
  0.00000000e+00, 1.17549435e-38, 2.35098870e-38, 4.70197740e-38,
  9.40395481e-38, 1.88079096e-37, 3.76158192e-37, 7.52316385e-37,
  1.50463277e-36, 3.00926554e-36, 6.01853108e-36, 1.20370622e-35,
  2.40741243e-35, 4.81482486e-35, 9.62964972e-35, 1.92592994e-34,
  3.85185989e-34, 7.70371978e-34, 1.54074396e-33, 3.08148791e-33,
  6.16297582e-33, 1.23259516e-32, 2.46519033e-32, 4.93038066e-32,
  9.86076132e-32, 1.97215226e-31, 3.94430453e-31, 7.88860905e-31,
  1.57772181e-30, 3.15544362e-30, 6.31088724e-30, 1.26217745e-29,
  2.52435490e-29, 5.04870979e-29, 1.00974196e-28, 2.01948392e-28,
  4.03896783e-28, 8.07793567e-28, 1.61558713e-27, 3.23117427e-27,
  6.46234854e-27, 1.29246971e-26, 2.58493941e-26, 5.16987883e-26,
  1.03397577e-25, 2.06795153e-25, 4.13590306e-25, 8.27180613e-25,
  1.65436123e-24, 3.30872245e-24, 6.61744490e-24, 1.32348898e-23,
  2.64697796e-23, 5.29395592e-23, 1.05879118e-22, 2.11758237e-22,
  4.23516474e-22, 8.47032947e-22, 1.69406589e-21, 3.38813179e-21,
  6.77626358e-21, 1.35525272e-20, 2.71050543e-20, 5.42101086e-20,
  1.08420217e-19, 2.16840434e-19, 4.33680869e-19, 8.67361738e-19,
  1.73472348e-18, 3.46944695e-18, 6.93889390e-18, 1.38777878e-17,
  2.77555756e-17, 5.55111512e-17, 1.11022302e-16, 2.22044605e-16,
  4.44089210e-16, 8.88178420e-16, 1.77635684e-15, 3.55271368e-15,
  7.10542736e-15, 1.42108547e-14, 2.84217094e-14, 5.68434189e-14,
  1.13686838e-13, 2.27373675e-13, 4.54747351e-13, 9.09494702e-13,
  1.81898940e-12, 3.63797881e-12, 7.27595761e-12, 1.45519152e-11,
  2.91038305e-11, 5.82076609e-11, 1.16415322e-10, 2.32830644e-10,
  4.65661287e-10, 9.31322575e-10, 1.86264515e-09, 3.72529030e-09,
  7.45058060e-09, 1.49011612e-08, 2.98023224e-08, 5.96046448e-08,
  1.19209290e-07, 2.38418579e-07, 4.76837158e-07, 9.53674316e-07,
  1.90734863e-06, 3.81469727e-06, 7.62939453e-06, 1.52587891e-05,
  3.05175781e-05, 6.10351562e-05, 1.22070312e-04, 2.44140625e-04,
  4.88281250e-04, 9.76562500e-04, 1.95312500e-03, 3.90625000e-03,
  7.81250000e-03, 1.56250000e-02, 3.12500000e-02, 6.25000000e-02,
  1.25000000e-01, 2.50000000e-01, 5.00000000e-01, 1.00000000e+00,
  2.00000000e+00, 4.00000000e+00, 8.00000000e+00, 1.60000000e+01,
  3.20000000e+01, 6.40000000e+01, 1.28000000e+02, 2.56000000e+02,
  5.12000000e+02, 1.02400000e+03, 2.04800000e+03, 4.09600000e+03,
  8.19200000e+03, 1.63840000e+04, 3.27680000e+04, 6.55360000e+04,
  1.31072000e+05, 2.62144000e+05, 5.24288000e+05, 1.04857600e+06,
  2.09715200e+06, 4.19430400e+06, 8.38860800e+06, 1.67772160e+07,
  3.35544320e+07, 6.71088640e+07, 1.34217728e+08, 2.68435456e+08,
  5.36870912e+08, 1.07374182e+09, 2.14748365e+09, 4.29496730e+09,
  8.58993459e+09, 1.71798692e+10, 3.43597384e+10, 6.87194767e+10,
  1.37438953e+11, 2.74877907e+11, 5.49755814e+11, 1.09951163e+12,
  2.19902326e+12, 4.39804651e+12, 8.79609302e+12, 1.75921860e+13,
  3.51843721e+13, 7.03687442e+13, 1.40737488e+14, 2.81474977e+14,
  5.62949953e+14, 1.12589991e+15, 2.25179981e+15, 4.50359963e+15,
  9.00719925e+15, 1.80143985e+16, 3.60287970e+16, 7.20575940e+16,
  1.44115188e+17, 2.88230376e+17, 5.76460752e+17, 1.15292150e+18,
  2.30584301e+18, 4.61168602e+18, 9.22337204e+18, 1.84467441e+19,
  3.68934881e+19, 7.37869763e+19, 1.47573953e+20, 2.95147905e+20,
  5.90295810e+20, 1.18059162e+21, 2.36118324e+21, 4.72236648e+21,
  9.44473297e+21, 1.88894659e+22, 3.77789319e+22, 7.55578637e+22,
  1.51115727e+23, 3.02231455e+23, 6.04462910e+23, 1.20892582e+24,
  2.41785164e+24, 4.83570328e+24, 9.67140656e+24, 1.93428131e+25,
  3.86856262e+25, 7.73712525e+25, 1.54742505e+26, 3.09485010e+26,
  6.18970020e+26, 1.23794004e+27, 2.47588008e+27, 4.95176016e+27,
  9.90352031e+27, 1.98070406e+28, 3.96140813e+28, 7.92281625e+28,
  1.58456325e+29, 3.16912650e+29, 6.33825300e+29, 1.26765060e+30,
  2.53530120e+30, 5.07060240e+30, 1.01412048e+31, 2.02824096e+31,
  4.05648192e+31, 8.11296384e+31, 1.62259277e+32, 3.24518554e+32,
  6.49037107e+32, 1.29807421e+33, 2.59614843e+33, 5.19229686e+33,
  1.03845937e+34, 2.07691874e+34, 4.15383749e+34, 8.30767497e+34,
  1.66153499e+35, 3.32306999e+35, 6.64613998e+35, 1.32922800e+36,
  2.65845599e+36, 5.31691198e+36, 1.06338240e+37, 2.12676479e+37,
  4.25352959e+37, 8.50705917e+37, 1.70141183e+38,
};


float
__scalbnf (float x, int n)
{
  float k;
  int32_t ke;

  k = __float_and8 (x);
  if (k == 0.0)
    {
      if (x == 0.0)
	return x;
      x *= two25;
      k = __float_and8 (x) / two25;
    }
  if (isnanf (k) || isinff (k))
    return x + x;
  ke = __float_get_exp (k) + n;
  if (n > 50000 || ke > 0xfe)
    return huge * __copysignf (huge, x);
  if (n < -50000)
    return tiny * __copysignf (tiny, x);
  /* ke <= 254 */
  if (ke > 0)
    {
      x = __float_set_exp (x, pow2[ke]);
      return x;
    }
  if (ke <= -25)
    return tiny * __copysignf (tiny, x);
  /* 0 <= ke <= 254 */
  k *= two25;
  ke += 25;
  x = __float_set_exp (x, pow2[ke]);
  return x * twom25;
}
weak_alias (__scalbnf, scalbnf)
